<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Character Viewer</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
    margin:0;
    min-height:100vh;
    font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;

    background:
        radial-gradient(circle at 20% 20%, #1b2140, transparent 40%),
        radial-gradient(circle at 80% 60%, #16253a, transparent 40%),
        #0f1117;

    color:white;
    padding:30px;
}

/* MAIN WRAPPER */
.viewer{
    background: var(--viewer-bg, rgba(26,29,38,0.75));
    backdrop-filter: blur(18px);

    border-radius:28px;
    padding:34px;

    border:1px solid rgba(255,255,255,0.05);

    box-shadow:
        0 40px 80px rgba(0,0,0,.45),
        inset 0 0 0 1px rgba(255,255,255,0.02);

    position:relative;
    overflow:hidden;
}


/* HEADER */
.hero{
    display:flex;
    gap:24px;
    align-items:center;
    flex-wrap:wrap;
}

.hero img{
    width:180px;
    height:180px;
    border-radius:50%;
    object-fit:cover;

    box-shadow:
        0 0 0 4px rgba(90,162,255,.2),
        0 12px 40px rgba(0,0,0,.5);
}

.hero-text{
    flex:1;
}

.name{
    font-size:34px;
    font-weight:800;
    letter-spacing:.5px;
}

.tags{
    margin-top:8px;
    color:#9aa3b2;
}

/* SECTION CARDS */
.section{
    margin-top:26px;
    padding:18px;

    border-radius:18px;

    background:rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.05);
}

.section-title{
    font-size:13px;
    letter-spacing:.12em;
    text-transform:uppercase;
    color:#8e97aa;
    margin-bottom:10px;
}

.section-content{
    font-size:15px;
    line-height:1.6;
}

/* RELATIONSHIP CHIPS */
.relationship-chip{
    display:inline-block;
    padding:6px 12px;
    border-radius:999px;
    background:rgba(90,162,255,.15);
    margin:4px;
    font-size:13px;
}

/* DOWNLOAD BUTTON */
.downloadBtn{
    margin-top:30px;
    width:100%;
    padding:16px;

    border:none;
    border-radius:16px;

    background:linear-gradient(135deg,#5aa2ff,#7ab6ff);

    color:white;
    font-size:16px;
    font-weight:600;

    cursor:pointer;

    box-shadow:0 10px 30px rgba(90,162,255,.25);
    transition:.2s;
}

.downloadBtn:hover{
    transform:translateY(-2px);
    box-shadow:0 18px 40px rgba(90,162,255,.35);
}


/* ================= GRADIENT ==============*/

.bgPanel{
    max-width:780px;
    margin:auto;
    margin-bottom:20px;
    padding:20px;
    border-radius:20px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.06);
}

.bgRow{
    display:flex;
    gap:10px;
    align-items:center;
    margin-bottom:12px;
}

.bgRow input[type="text"]{
    flex:1;
}


/* ================ BACKGROUND EFFECTS ============== */

.viewer{
    position:relative;
    overflow:hidden;
}

.viewer::before{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    opacity:0;
    transition:.3s;
}

/* NOISE */
.viewer.noise::before{
    opacity:.08;
    background-image:url("https://grainy-gradients.vercel.app/noise.svg");
}

/* GLOW */
.viewer.glow::after{
    content:"";
    position:absolute;
    inset:-40%;
    background:radial-gradient(circle at center,
        rgba(255,255,255,.15),
        transparent 60%);
    pointer-events:none;
}

/* PARTICLES */
.viewer.particles::after{
    content:"";
    position:absolute;
    inset:0;
    background-image:
        radial-gradient(circle, rgba(255,255,255,.08) 1px, transparent 1px);
    background-size:60px 60px;
    animation:particleMove 40s linear infinite;
    pointer-events:none;
}

@keyframes particleMove{
    from{ background-position:0 0; }
    to{ background-position:600px 600px; }
}




</style>
</head>

<body>
    
    <!-- BODY -->
    
    
<div style="max-width:780px;margin:auto;margin-bottom:20px;">

    <label>Background Color</label>

    <div style="display:flex; gap:10px; margin-top:6px;">
        <input type="color" id="bgColorPicker" value="#1a1d26">

        <input type="text"
               id="bgHexInput"
               placeholder="#1a1d26"
               style="flex:1;">
    </div>

</div>

<div class="bgPanel">

    <h3>Background Builder</h3>

    <div class="bgRow">
        <label>Color A</label>
        <input type="color" id="gradA" value="#1a1d26">
        <input type="text" id="gradAHex" placeholder="#1a1d26">
    </div>

    <div class="bgRow">
        <label>Color B</label>
        <input type="color" id="gradB" value="#5aa2ff">
        <input type="text" id="gradBHex" placeholder="#5aa2ff">
    </div>

    <div class="bgRow">
        <label>Angle</label>
        <input type="range" id="gradAngle" min="0" max="360" value="135">
        <span id="angleLabel">135°</span>
    </div>

    <h3>Effects</h3>

    <label><input type="checkbox" id="noiseToggle"> Noise Texture</label>
    <label><input type="checkbox" id="glowToggle"> Glow Vignette</label>
    <label><input type="checkbox" id="particleToggle"> Particle Shimmer</label>

</div>


<div class="viewer" id="viewerCard">

    <div class="hero">
        <img id="vImage">

        <div class="hero-text">
            <div class="name" id="vName"></div>
            <div class="tags" id="vTags"></div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        <div class="section-content" id="vDesc"></div>
    </div>

    <div class="section">
        <div class="section-title">Lore</div>
        <div class="section-content" id="vLore"></div>
    </div>

    <div class="section">
        <div class="section-title">Life Data</div>
        <div class="section-content" id="vLife"></div>
    </div>

    <div class="section">
        <div class="section-title">Relationships</div>
        <div class="section-content" id="vRelationships"></div>
    </div>

</div>

<button id="downloadBtn" class="downloadBtn">
Download Character PNG
</button>


<!-- JAVASCRIPT -->

<script>
const chars = JSON.parse(localStorage.getItem("characters")) || [];
const index = localStorage.getItem("viewingCharacterIndex");
const char = chars[index];

if(!char){
    alert("Character not found");
    location.href = "character.html";
}

vImage.src = char.image || "";
vName.textContent = char.name || "Unnamed";
vDesc.textContent = char.desc || "-";
vTags.textContent = char.tags || "-";

vLore.innerHTML = `
Species: ${char.species || "-"}<br>
Faction: ${char.faction || "-"}<br>
Origin: ${char.origin || "-"}<br>
Alignment: ${char.alignment || "-"}
`;

vLife.innerHTML = `
Birth: ${char.birthDate || "-"}<br>
Death: ${char.deathDate || "Alive"}<br>
Status: ${char.status || "-"}<br>
Age: ${char.age || "-"}
`;


vRelationships.innerHTML = (char.relationships || [])
.map(r => `<span class="relationship-chip">${r.name} — ${r.type}</span>`)
.join("") || "None";


/* DOWNLOAD PNG */
downloadBtn.onclick = () => {

    html2canvas(document.getElementById("viewerCard"), {
        backgroundColor: null,
        useCORS: true
    }).then(canvas=>{
        const link = document.createElement("a");
        link.download = (char.name || "character") + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });

};


/* ================ COLOR DETECTORS =================*/

const picker = document.getElementById("bgColorPicker");
const hexInput = document.getElementById("bgHexInput");
const viewer = document.getElementById("viewerCard");

/* HEX → RGB */
function hexToRgb(hex){

    hex = hex.replace("#","");

    if(hex.length === 3){
        hex = hex.split("").map(c => c+c).join("");
    }

    const num = parseInt(hex, 16);

    return {
        r:(num >> 16) & 255,
        g:(num >> 8) & 255,
        b:num & 255
    };
}

/* BRIGHTNESS DETECTOR */
function getBrightness({r,g,b}){
    return (r*299 + g*587 + b*114) / 1000;
}

/* APPLY BACKGROUND + AUTO TEXT */
function applyBackground(hex){

    if(!hex.startsWith("#")) hex = "#"+hex;

    viewer.style.setProperty("--viewer-bg", hex);

    const rgb = hexToRgb(hex);
    const brightness = getBrightness(rgb);

    if(brightness > 150){
        viewer.style.color = "#111";
    }else{
        viewer.style.color = "#fff";
    }
}


/* PICKER → HEX */
picker.addEventListener("input", ()=>{
    hexInput.value = picker.value;
    applyBackground(picker.value);
});

/* HEX → PICKER */
hexInput.addEventListener("input", ()=>{

    let val = hexInput.value.trim();

    if(!val.startsWith("#")) val = "#"+val;

    if(/^#[0-9A-F]{6}$/i.test(val)){
        picker.value = val;
        applyBackground(val);
    }
});


/* ======================= GRADIENT ENGINE ====================== */

const gradA = document.getElementById("gradA");
const gradB = document.getElementById("gradB");
const gradAHex = document.getElementById("gradAHex");
const gradBHex = document.getElementById("gradBHex");
const gradAngle = document.getElementById("gradAngle");
const angleLabel = document.getElementById("angleLabel");

function applyGradient(){

    const a = gradA.value;
    const b = gradB.value;
    const angle = gradAngle.value;

    viewer.style.setProperty(
        "--viewer-bg",
        `linear-gradient(${angle}deg, ${a}, ${b})`
    );

    autoTextFromGradient(a, b);
}

gradA.oninput = ()=> {
    gradAHex.value = gradA.value;
    applyGradient();
};

gradB.oninput = ()=> {
    gradBHex.value = gradB.value;
    applyGradient();
};

gradAngle.oninput = ()=>{
    angleLabel.textContent = gradAngle.value + "°";
    applyGradient();
};


/* TEXT DETECTION */

function autoTextFromGradient(hexA, hexB){

    const rgbA = hexToRgb(hexA);
    const rgbB = hexToRgb(hexB);

    const avg = {
        r:(rgbA.r + rgbB.r)/2,
        g:(rgbA.g + rgbB.g)/2,
        b:(rgbA.b + rgbB.b)/2
    };

    const brightness = getBrightness(avg);

    viewer.style.color = brightness > 150 ? "#111" : "#fff";
}

gradAHex.addEventListener("input", ()=>{
    let val = gradAHex.value.trim();
    if(!val.startsWith("#")) val = "#"+val;

    if(/^#[0-9A-F]{6}$/i.test(val)){
        gradA.value = val;
        applyGradient();
    }
});

gradBHex.addEventListener("input", ()=>{
    let val = gradBHex.value.trim();
    if(!val.startsWith("#")) val = "#"+val;

    if(/^#[0-9A-F]{6}$/i.test(val)){
        gradB.value = val;
        applyGradient();
gradAHex.value = gradA.value;
gradBHex.value = gradB.value;

    }
});



/* ============== EFFECT TOGGLE =============== */

const noiseToggle = document.getElementById("noiseToggle");
const glowToggle = document.getElementById("glowToggle");
const particleToggle = document.getElementById("particleToggle");

noiseToggle.onchange = ()=>{
    viewer.classList.toggle("noise", noiseToggle.checked);
};

glowToggle.onchange = ()=>{
    viewer.classList.toggle("glow", glowToggle.checked);
};

particleToggle.onchange = ()=>{
    viewer.classList.toggle("particles", particleToggle.checked);
};




</script>

</body>
</html>
